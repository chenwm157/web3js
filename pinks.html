<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>send</title>
</head>
<body>
    <script src="https://cdn.bootcdn.net/ajax/libs/web3/1.7.4/web3.min.js"></script>
    <script type="text/javascript" >
    
   
    if (typeof web3 !== 'undefined') {
    web3 = new Web3(web3.currentProvider);
    } else {
        // set the provider you want from Web3.providers
        rpcurl = "https://bsc-dataseed3.ninicoin.io/"
        // "http://localhost:8545"
        web3 = new Web3(new Web3.providers.HttpProvider(rpcurl));
    }

	_chainID = 56

    key = ''
    address=''
    toadr = ''
    value=''
    gl = ''
    gp = ''
    data = ''

    function  senddata(account1,key1,toaddress,value,data,gasp,gasl){

    web3.eth.getTransactionCount(account1, (err, txCount) => {
      // 创建交易对象
	  
      const txObject = {
      nonce:    web3.utils.toHex(txCount),
      to:       toaddress,
      value:    web3.utils.toHex(web3.utils.toWei(value, 'ether')),
      gasLimit: web3.utils.toHex(gasl),
      gasPrice: web3.utils.toHex(web3.utils.toWei(gasp, 'gwei')),
      data:data,
      chainId:_chainID
    }
    web3.eth.accounts.signTransaction(
      txObject, key1).then(function(data){
   //   web3.eth.sendSignedTransaction(data.rawTransaction).on('receipt', (res)=>{
//		console.log(res)
//		alert(res.status)
//	  });
	 web3.eth.sendSignedTransaction(data.rawTransaction,function(err,res){
		if(err){
		alert(err)
		}
	 }).on('receipt', (res)=>{
		console.log(res)
		alert(res.status)
	  });
	
  })
  })
  }
  function getbalance(currentAccount){
		web3.eth.getBalance(currentAccount, (err,result) => {
		if (err== null) {
		//	console.log(result);
		  bnb = web3.utils.fromWei(result,'ether')
		  document.getElementById('bnb').text = bnb
		}else  {
		  console.log('~error:'+err);
		}
	  })}
  function changekey(){
    nw = document.getElementById('network').value
    web3 = new Web3(new Web3.providers.HttpProvider(nw));
    cid1 = document.getElementById('cid').value
    _chainID = cid1
		key = document.getElementById('key').value
		address = web3.eth.accounts.privateKeyToAccount(key).address
		document.getElementById('address').text = address
		
		getbalance(address)
	}

    function buy(){

        document.getElementById

	      value = document.getElementById('numbnb').value
        toadr = document.getElementById('toaddress').value
        gp = document.getElementById('gp1').value
        gl = document.getElementById('gl1').value
        data = document.getElementById('data1').value
        var hms1 = document.getElementById('hms').value
        var sn1 = document.getElementById('sn').value
        
        
        h1 = parseInt( hms1.slice(0,2))
        m1 = parseInt( hms1.slice(2,4))
        s1 = parseInt( hms1.slice(4,6))
        sn1 = parseInt(sn1)
        
        var tdate = getDate()
        
        var t0 = tdate[0] * 60 *60 + tdate[1] * 60 + tdate[2]
        var t1 = h1 * 60 * 60 + m1 * 60 + s1 - sn1
        console.log([t0,t1,tdate])
        
        var ctime =( t1 - t0 ) * 1000
        console.log(ctime)

        if( ctime>0){
          _timeList = document.getElementById('timeList')
          _timeList.innerHTML = _timeList.innerHTML + "定制时间：" + new Date() + "</br>" +"执行时间：" + hms1 +  "</br>";
        }
        (function(hms){
        setTimeout(
            function(){
              _timeList = document.getElementById('timeList')
              _timeList.innerHTML = _timeList.innerHTML  +"已执行：" + hms1 +  "</br>";
               do1()
            },ctime
        )})(hms1);
        
    }

    

    function getDate(){
        var mydate = new Date()

        newh = mydate.getHours()
        newm = mydate.getMinutes()
        news = mydate.getSeconds()
        return [newh,newm,news]
    }

   
    function do1(){
        senddata(address,key,toadr,value,data,gp,gl)
    }
    

	</script> 

<div id="box1">
  <div id="box2">
  <h3>抢预售</h3>
  <a>网络</a><input type="text" style="width: 230px;" value="https://bsc-dataseed3.ninicoin.io/" id="network"></br>
  <a>chainId</a><input type="text" style="width: 30px;" value="56" id="cid"></br>
  <a>私钥<a><input type="text" value="" id="key"><input type="button" value="确定" onclick="changekey()"></br>
  <a>地址:<a><a id="address"><a></br>
  <a>主币余额: <a><a id="bnb"><a></br></br>
  <a>发送地址<a><input type="text" value="" id="toaddress"></br> 
  <a>主币数量<a><input type="text" value="" id="numbnb"></br>
  <a>gas price<a><input type="text" value="5.2" id="gp1"></br>
  <a>gas limit<a><input type="text" value="500000" id="gl1"></br>
  <a>发送数据</a><input type="text" value="" id="data1"></br>
  <a>提前n秒</a><input type="text" value="6" id="sn"></br>
  <a>发送时间<a>
      <input type="text" value="0" id="hms"></br><a>（格式示意12点半表示 123000,0表示立即）</a>
    </br><a>（格式示意早8点半表示 083000,前面补齐0）</a>
  </br><a>（提前n秒正常是5-9秒上链时间，具体几秒，先给自己地址定时转账一笔确认，比如说转一笔123000时间，链上确认时间要在00秒到03秒之间，这是第一个块，否则得调整提前时间）</a>
  </br></br>  <a>    <a><input type="button" value="发送" onclick="buy()"> 

    <div style="width: 300px">
      <p>定时列表：</p>
      <div
        style="
          width: 300px;
          height: 200px;
          border: 1px solid #ddd;
          overflow: auto;
          
        "
        id="timeList"
      ></div>
  </div>
 </div>
 <style>
  div {        
    opacity: 1;
  }
  #box2{
    width: 320px;
    margin:0 auto;
  }
  #box1::before {
    display: block;
    width: 100%;
    height: 100%;
    background-image: url("brg.jpg");
    background-attachment: fixed;
    position: absolute;
    top: 0;
    left: 0;
    content: "";
    z-index: -1;
    filter: opacity(0.4);
  }

</style>
</body>
</html>